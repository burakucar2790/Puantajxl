<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PuantajXL | YÃ¶netim Sistemi</title>
    <style>
        :root {
            --bg: #f0f2f5; 
            --card: #ffffff; 
            --text: #1a202c;
            --primary: #3b82f6; 
            --success: #10b981; 
            --danger: #ef4444;
            --warning: #f59e0b; 
            --info: #8b5cf6; 
            --annual: #ec4899; 
            --holiday: #6366f1; 
            --border: #e2e8f0;
            --input-bg: #ffffff;
            --shadow: rgba(0, 0, 0, 0.1);
            --tooltip-bg: #334155;
            --tooltip-text: #fff;
        }

        .dark-mode {
            --bg: #0f172a; 
            --card: #1e293b; 
            --text: #f1f5f9; 
            --border: #334155;
            --input-bg: #0f172a;
            --shadow: rgba(0, 0, 0, 0.4);
            --tooltip-bg: #f1f5f9;
            --tooltip-text: #0f172a;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--bg); 
            color: var(--text);
            margin: 0; 
            padding: 0; 
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- Global Header & Navigation --- */
        .app-header {
            background: var(--card);
            border-bottom: 1px solid var(--border);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .brand-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .brand-logo {
            font-size: 1.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-tabs {
            display: flex;
            background: var(--bg);
            padding: 5px;
            border-radius: 12px;
            gap: 5px;
            overflow-x: auto;
        }

        .nav-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            background: transparent;
            color: var(--text);
            transition: 0.2s;
            white-space: nowrap;
        }

        .nav-btn.active {
            background: var(--card);
            color: var(--primary);
            box-shadow: 0 2px 5px var(--shadow);
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: 0.2s;
        }
        .action-btn:hover { background: var(--border); }

        /* --- Tooltips --- */
        .tooltip-container {
            position: relative;
            display: inline-flex;
            align-items: center;
            margin-left: 5px;
            cursor: help;
        }
        .tooltip-icon {
            background: var(--info);
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }
        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--tooltip-bg);
            color: var(--tooltip-text);
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1001;
            bottom: 125%; 
            left: 50%; 
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            pointer-events: none;
        }
        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--tooltip-bg) transparent transparent transparent;
        }
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* --- Main Containers --- */
        .module-container {
            display: none;
            padding: 20px;
            max-width: 1100px;
            margin: 0 auto;
            animation: fadeIn 0.3s ease;
        }
        .module-container.active-module { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Inputs --- */
        input, select, textarea {
            background: var(--input-bg); 
            border: 1px solid var(--border);
            color: var(--text); 
            padding: 14px; 
            border-radius: 12px; 
            font-size: 14px; 
            outline: none;
            width: 100%;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
        }
        
        /* --- Module 1: Ä°ÅŸ Takip --- */
        .header-banner {
            background: linear-gradient(135deg, var(--primary), var(--info));
            color: white; padding: 30px; border-radius: 24px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2); margin-bottom: 25px;
            position: relative; overflow: hidden;
            cursor: pointer; /* TÄ±klanabilir */
            transition: transform 0.2s;
        }
        .header-banner:hover { transform: scale(1.01); }
        .weather-icon { font-size: 2.5rem; margin-right: 10px; vertical-align: middle; }

        .stats-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-item { background: var(--card); padding: 15px; border-radius: 18px; text-align: center; border: 1px solid var(--border); }
        .stat-item b { font-size: 1.4rem; display: block; }
        .stat-item small { color: #64748b; text-transform: uppercase; font-weight: bold; font-size: 0.65rem; }
        .glass-card { background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid var(--border); margin-bottom: 25px; }
        
        .input-row { display: grid; grid-template-columns: 2fr 1.5fr 1fr 1fr; gap: 15px; margin-bottom: 15px; align-items: center;}
        .input-row textarea { grid-column: span 4; resize: vertical; }

        /* Input Labels inside rows */
        .input-group { position: relative; width: 100%; }
        .input-group label {
            font-size: 0.75rem; color: var(--text); opacity: 0.7; margin-bottom: 4px; display: block; font-weight: 600;
            display: flex; align-items: center;
        }

        .btn-row { display: flex; gap: 12px; flex-wrap: wrap; }
        .btn { padding: 12px 24px; border: none; border-radius: 12px; cursor: pointer; font-weight: 700; display: flex; align-items: center; gap: 8px; transition: 0.2s; color: white; }
        .btn-save { background: var(--primary); flex: 2; }
        .btn-excel { background: var(--success); }
        .btn-clean { background: #94a3b8; }
        #batchArea { display: none; align-items: center; gap: 15px; margin-bottom: 15px; background: var(--card); padding: 10px 20px; border-radius: 12px; border: 1px solid var(--border); }
        .note-card { background: var(--card); padding: 20px; border-radius: 18px; margin-bottom: 15px; border: 1px solid var(--border); position: relative; display: flex; gap: 15px; align-items: flex-start; }
        .status-pill { position: absolute; right: 20px; top: 20px; padding: 5px 12px; border-radius: 8px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; }
        .sp-geldi { background: #dcfce7; color: #166534; }
        .sp-gelmedi { background: #fee2e2; color: #991b1b; }
        .sp-raporlu { background: #fef3c7; color: #92400e; }
        .sp-izinli { background: #e0f2fe; color: #075985; }
        .sp-yÄ±llÄ±k { background: #fce7f3; color: #9d174d; }
        .sp-tatil { background: #e0e7ff; color: #3730a3; }
        .actions { margin-top: 15px; border-top: 1px solid var(--border); padding-top: 15px; display: flex; gap: 10px; }
        .btn-del { background: none; color: var(--danger); border: 1px solid var(--danger); padding: 5px 10px; border-radius: 6px; cursor: pointer; }

        /* --- Module 2: MaaÅŸ --- */
        .maas-card-main { 
            max-width: 600px; margin: 0 auto; background: var(--card); padding: 25px; 
            border-radius: 20px; box-shadow: 0 15px 35px var(--shadow); border: 1px solid var(--border);
            position: relative;
        }
        .maas-ust-butonlar { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-bottom: 20px; }
        .maas-ust-btn { cursor: pointer; background: var(--bg); border: 1px solid var(--border); padding: 8px 12px; border-radius: 10px; font-size: 13px; color: var(--text); }
        .ayar-kart { background: var(--bg); border: 1px solid var(--border); padding: 15px; border-radius: 15px; margin-bottom: 12px; }
        .ayar-kart label { font-size: 13px; font-weight: 600; color: var(--text); opacity: 0.8; display: block; margin-bottom: 5px; display: flex; align-items: center;}
        button.aksiyon-btn { width: 100%; padding: 15px; border: none; border-radius: 10px; margin-top: 15px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.2s; }
        .hesapla-btn { background-color: var(--success); color: white; }
        .kaydet-btn { background-color: var(--primary); color: white; }
        .vazgec-btn { background-color: #6c757d; color: white; margin-top: 10px; }
        .sonuc-alani { margin-top: 20px; padding: 20px; background: var(--bg); border-radius: 15px; border: 2px solid var(--border); display: none; }
        .sonuc-baslik { font-weight: 800; color: var(--success); border-bottom: 2px solid var(--border); padding-bottom: 10px; margin-bottom: 10px; text-align: center; }
        .sonuc-satir { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px dashed var(--border); font-size: 14px; }
        .toplam-vurgu { font-size: 20px; font-weight: 900; color: var(--success); border-top: 2px solid var(--success); margin-top: 15px; padding-top: 10px; }
        .mesai-grup { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .gecmis-kart { background: var(--bg); border: 1px solid var(--border); padding: 15px; border-radius: 15px; margin-bottom: 15px; font-size: 13px; position: relative; }
        .tek-sil-btn { position: absolute; top: 10px; right: 10px; background: var(--danger); color: white; border-radius: 5px; padding: 2px 6px; cursor: pointer; font-size: 10px; }
        .calc-screen { grid-column: span 4; background: #222; color: #0f0; padding: 20px; text-align: right; font-size: 24px; border-radius: 10px; margin-bottom: 10px; font-family: 'Courier New'; }
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
        .calc-btn { padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; background: var(--border); color: var(--text); font-size: 16px; }
        .calc-btn.op { background: var(--warning); color: white; }
        .calc-btn.eq { background: var(--success); color: white; grid-column: span 2; }

        /* --- Module 3: Piyasa & Haberler --- */
        .market-container {
            display: grid;
            gap: 20px;
        }
        .widget-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 15px;
            overflow: hidden;
            height: 100%;
        }

        /* --- Modals --- */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(2px); overflow-y: auto;}
        .modal-content { background-color: var(--card); margin: 5% auto; padding: 25px; border: 1px solid var(--border); width: 90%; max-width: 500px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); position: relative; }
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: var(--text); opacity: 0.6; }
        
        /* Table Styles for Modal */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .data-table th, .data-table td { text-align: left; padding: 10px; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .data-table th { color: var(--primary); }

        /* --- MOBÄ°L Ä°YÄ°LEÅTÄ°RMELERÄ° (Bunu style etiketinin en altÄ±na ekle) --- */

@media (max-width: 768px) { 
    /* Genel Konteyner AyarlarÄ± */
    .module-container {
        padding: 10px !important; /* Kenar boÅŸluklarÄ±nÄ± azalttÄ±m */
        width: 100% !important;
        box-sizing: border-box;
    }

    /* Header (Ãœst Bar) DÃ¼zenlemesi */
    .app-header {
        flex-direction: column;
        gap: 10px;
        padding: 10px;
    }
    .brand-logo { font-size: 1.2rem; }
    .nav-tabs { 
        width: 100%; 
        justify-content: space-between; /* ButonlarÄ± yay */
        gap: 2px;
    }
    .nav-btn {
        padding: 8px 10px; /* Buton iÃ§ boÅŸluÄŸunu kÃ¼Ã§Ã¼lttÃ¼m */
        font-size: 0.8rem;
        flex: 1; /* Hepsi eÅŸit geniÅŸlikte olsun */
        text-align: center;
    }

    /* Banner ve Ä°statistikler */
    .header-banner {
        padding: 15px !important;
        flex-direction: column; /* Mobilde alt alta olsun */
        text-align: center;
        gap: 10px;
    }
    .header-banner > div { text-align: center !important; }
    .header-banner #weather-info { font-size: 1.4rem !important; }
    
    /* Ä°statistik KartlarÄ± (Puantaj Ã–zeti) */
    .stats-bar {
        /* 130px Ã§ok fazlaydÄ±, 90px'e Ã§ektim ki yan yana 3 tane sÄ±ÄŸsÄ±n */
        grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)) !important; 
        gap: 8px;
    }
    .stat-item { padding: 10px; }
    .stat-item b { font-size: 1.1rem; }
    .stat-item small { font-size: 0.6rem; }

    /* Form AlanlarÄ± */
    .glass-card { padding: 15px; }
    .input-row { 
        grid-template-columns: 1fr !important; 
        gap: 10px; 
    } 
    .input-row textarea { grid-column: span 1 !important; }
    
    /* Butonlar */
    .btn-row { flex-direction: column; }
    .btn { width: 100%; justify-content: center; }

    /* MaaÅŸ Hesaplama & Hesap Makinesi */
    .maas-card-main { padding: 15px; }
    .calc-grid { gap: 5px; }
    .calc-btn { padding: 10px; font-size: 14px; }
    .mesai-grup { grid-template-columns: 1fr; } /* Mesai alanlarÄ±nÄ± alt alta al */
    
    /* Font BoyutlarÄ±nÄ± EhlileÅŸtirme */
    h1 { font-size: 1.5rem !important; }
    h2 { font-size: 1.3rem !important; }
    h3 { font-size: 1.1rem !important; }
    input, select, textarea { padding: 10px; font-size: 13px; }
}

/* Ã‡ok KÃ¼Ã§Ã¼k Ekranlar (iPhone SE vb.) iÃ§in Ekstra Ayar */
@media (max-width: 380px) {
    .nav-btn { font-size: 0.7rem; padding: 6px; }
    .stats-bar { grid-template-columns: 1fr 1fr !important; } /* En kÃ¼Ã§Ã¼kte 2'li olsun */
}

    </style>
</head>
<body>

<div class="app-header">
    <div class="brand-area">
        <div class="brand-logo">PuantajXL Sidelya</div>
    </div>
    <div class="nav-tabs">
    <button class="nav-btn active" onclick="switchModule('puantaj', this)">ğŸ“‹ Puantaj</button>
    <button class="nav-btn" onclick="switchModule('maas', this)">ğŸ’° MaaÅŸ Hesaplama</button>
    <button class="nav-btn" onclick="switchModule('piyasa', this)">ğŸ“ˆ Piyasa & Haber</button>
</div>
    <div class="header-actions">
        <button class="action-btn" onclick="toggleTheme()">ğŸŒ“</button>
        <button class="action-btn" onclick="openSettings()">âš™ï¸ Ayarlar</button>
        <button class="action-btn" onclick="openManual()">â“ KÄ±lavuz</button>
        <button class="action-btn" onclick="openAbout()">â„¹ï¸</button>
    </div>
</div>

<div id="module-puantaj" class="module-container active-module">
    <div class="header-banner" onclick="openWeatherModal()" title="Hava durumu ve tatiller iÃ§in tÄ±kla">
        <div class="clock-section">
            <h1 id="live-clock" style="margin:0;">00:00:00</h1>
            <p id="live-date" style="margin:5px 0 0 0; opacity:0.9;">...</p>
        </div>
        <div style="text-align: right;">
            <div style="display:flex; align-items:center; justify-content: flex-end;">
                <span id="weather-icon" class="weather-icon">â˜€ï¸</span>
                <span id="weather-info" style="font-size: 1.8rem; font-weight: bold;">--Â°C</span>
            </div>
            <p id="city-label" style="margin:0; opacity:0.8;"> Ä°stanbul</p>
        </div>
        <div style="position: absolute; bottom: 0px; right: 50%; transform: translateX(50%); font-size: 0.7rem; opacity: 0.6;">(Detaylar iÃ§in tÄ±kla)</div>
    </div>

    <div class="stats-bar">
        <div class="stat-item"><small>Toplam</small><b id="s-total">0</b></div>
        <div class="stat-item" style="color:var(--success)"><small>Geldi</small><b id="s-geldi">0</b></div>
        <div class="stat-item" style="color:var(--danger)"><small>Gelmedi</small><b id="s-gelmedi">0</b></div>
        <div class="stat-item" style="color:var(--annual)"><small>Y. Ä°zin</small><b id="s-yillik">0</b></div>
        <div class="stat-item" style="color:var(--holiday)"><small>Tatil</small><b id="s-tatil">0</b></div>
    </div>

    <div class="glass-card">
        <div class="input-row">
            <div class="input-group">
                <label>Personel / Ä°ÅŸ AdÄ±</label>
                <input type="text" id="nodeName" placeholder="Ã–rn: Ahmet YÄ±lmaz">
            </div>
            
            <div class="input-group">
                <label>Durum SeÃ§imi</label>
                <select id="nodeStatus">
                    <option value="Geldi">Geldi</option>
                    <option value="Gelmedi">Gelmedi</option>
                    <option value="Raporlu">Raporlu</option>
                    <option value="Ä°zinli">Ä°zinli</option>
                    <option value="YÄ±llÄ±k">YÄ±llÄ±k Ä°zin</option>
                    <option value="Tatil">Resmi/Bayram Tatili</option>
                </select>
            </div>
            
            <div class="input-group">
                <label>BaÅŸlangÄ±Ã§ <span class="tooltip-container"><span class="tooltip-icon">?</span><span class="tooltip-text">Ä°ÅŸin veya iznin baÅŸladÄ±ÄŸÄ± tarih.</span></span></label>
                <input type="date" id="nodeDate">
            </div>
            
            <div class="input-group">
                <label>BitiÅŸ (Opsiyonel) <span class="tooltip-container"><span class="tooltip-icon">?</span><span class="tooltip-text">EÄŸer izin veya iÅŸ birden fazla gÃ¼n sÃ¼rdÃ¼yse bitiÅŸ tarihini seÃ§.</span></span></label>
                <input type="date" id="nodeEndDate">
            </div>
            
            <textarea id="nodeContent" rows="2" placeholder="Notlar, mazeretler veya tatil aÃ§Ä±klamasÄ±..."></textarea>
        </div>
        
        <input type="hidden" id="editIndex" value="-1">
        
        <div class="btn-row">
            <button class="btn btn-save" onclick="saveRecord()">KaydÄ± Ä°ÅŸle</button>
            <button class="btn btn-excel" onclick="exportExcel()">Excel</button>
            <button class="btn btn-clean" onclick="resetForm()">Temizle</button>
        </div>
    </div>

    <div id="batchArea">
        <input type="checkbox" id="selectAll" onclick="toggleSelectAll()" style="width:18px; height:18px; cursor:pointer;">
        <label for="selectAll" style="cursor:pointer; font-weight:600;">TÃ¼mÃ¼nÃ¼ SeÃ§</label>
        <button class="btn-del" onclick="deleteSelected()" style="margin-left:auto; font-weight:bold;">SeÃ§ilenleri Sil</button>
        <select id="monthFilter" onchange="render()" style="padding:5px; border-radius:8px;"></select>
    </div>

    <input type="text" id="searchBar" placeholder="Listede hÄ±zlÄ± ara..." onkeyup="render()" style="margin-bottom: 20px; width: 100%;">

    <div id="output"></div>
</div>

<div id="module-maas" class="module-container">
    <div class="maas-card-main">
        <div class="maas-ust-butonlar">
            <div class="maas-ust-btn" onclick="gecmisToggle()">ğŸ“œ GeÃ§miÅŸ</div>
            <div class="maas-ust-btn" onclick="calcToggle()">ğŸ§® Hesap Makinesi</div>
            <div class="maas-ust-btn" onclick="panelToggle()">ğŸ›  MaaÅŸ AyarlarÄ±</div>
        </div>

        <div id="gecmisPaneli" style="display:none;">
            <div class="maas-ust-btn" style="display:inline-block; margin-bottom:15px; color:var(--danger); border-color:var(--danger);" onclick="anaFormuAc()">â† Geri DÃ¶n</div>
            <h3 style="text-align:center;">Hesap GeÃ§miÅŸi</h3>
            <div id="gecmisListe" class="gecmis-liste" style="max-height:400px; overflow-y:auto;"></div>
            <button class="aksiyon-btn vazgec-btn" style="background:var(--danger)" onclick="gecmisTemizle()">GEÃ‡MÄ°ÅÄ° TEMÄ°ZLE</button>
        </div>

        <div id="hesapMakinesiPaneli" style="display:none;">
            <div class="maas-ust-btn" style="display:inline-block; margin-bottom:15px;" onclick="anaFormuAc()">âœ• Kapat</div>
            <h3 style="text-align:center;">Hesap Makinesi</h3>
            <div class="calc-screen" id="calcDisplay">0</div>
            <div class="calc-grid">
                <button class="calc-btn" style="background:var(--danger); color:white;" onclick="calcClear()">C</button>
                <button class="calc-btn op" onclick="calcInput('/')">Ã·</button>
                <button class="calc-btn op" onclick="calcInput('*')">Ã—</button>
                <button class="calc-btn op" onclick="calcInput('-')">-</button>
                <button class="calc-btn" onclick="calcInput('7')">7</button>
                <button class="calc-btn" onclick="calcInput('8')">8</button>
                <button class="calc-btn" onclick="calcInput('9')">9</button>
                <button class="calc-btn op" onclick="calcInput('+')">+</button>
                <button class="calc-btn" onclick="calcInput('4')">4</button>
                <button class="calc-btn" onclick="calcInput('5')">5</button>
                <button class="calc-btn" onclick="calcInput('6')">6</button>
                <button class="calc-btn" onclick="calcInput('.')">.</button>
                <button class="calc-btn" onclick="calcInput('1')">1</button>
                <button class="calc-btn" onclick="calcInput('2')">2</button>
                <button class="calc-btn" onclick="calcInput('3')">3</button>
                <button class="calc-btn" onclick="calcInput('0')">0</button>
                <button class="calc-btn eq" onclick="calcResult()">=</button>
            </div>
        </div>

        <div id="yÃ¶netimPaneli" style="display:none;">
            <div class="maas-ust-btn" style="display:inline-block; margin-bottom:15px;" onclick="anaFormuAc()">âœ• Ä°ptal</div>
            <h3 style="text-align:center;">Sistem AyarlarÄ±</h3>
            <div class="ayar-kart">
                <label>Hesaplama Modu <span class="tooltip-container"><span class="tooltip-icon">?</span><span class="tooltip-text">MaaÅŸ: AylÄ±k sabit Ã¼cret Ã¼zerinden hesaplar. Yevmiye: GÃ¼nlÃ¼k Ã¼cret Ã¼zerinden hesaplar.</span></span></label>
                <select id="set_mod">
                    <option value="sabit">MaaÅŸ UsulÃ¼ (Oransal Hesap)</option>
                    <option value="yevmiye">Yevmiye UsulÃ¼ (Fiili GÃ¼n)</option>
                </select>
            </div>
            
            <div class="ayar-kart" style="border:1px solid var(--info);">
                <label style="color:var(--info);">GÃ¼nlÃ¼k Ã‡alÄ±ÅŸma Saati (BÃ¶len)</label>
                <select id="set_gunluk_saat">
                    <option value="7.5">Standart (7.5 Saat)</option>
                    <option value="8">8 Saat</option>
                    <option value="9">9 Saat</option>
                    <option value="10">10 Saat</option>
                    <option value="11">11 Saat</option>
                    <option value="12">12 Saat</option>
                    <option value="16">16 Saat</option>
                </select>
                <small style="display:block; margin-top:5px; color:#64748b;">* Saatlik Ã¼cret bu sÃ¼reye bÃ¶lÃ¼nerek hesaplanÄ±r.</small>
            </div>

            <div class="ayar-kart">
                <label>GeÃ§miÅŸ SÄ±nÄ±rÄ±</label>
                <input type="number" id="set_gecmis_sinir" min="1" max="50">
            </div>
            <div class="ayar-kart">
                <label>Sistem Net Asgari Ãœcret (TL) <span class="tooltip-container"><span class="tooltip-icon">?</span><span class="tooltip-text">VarsayÄ±lan asgari Ã¼cret tutarÄ±. 2025 iÃ§in 17.002 TL olarak ayarlÄ±.</span></span></label>
                <input type="text" id="set_asgari" oninput="formatInput(this)">
            </div>
            <div class="ayar-kart">
                <label>Mesai KatsayÄ±larÄ± <span class="tooltip-container"><span class="tooltip-icon">?</span><span class="tooltip-text">Normal Ã§alÄ±ÅŸma saati dÄ±ÅŸÄ±nda yapÄ±lan Ã§alÄ±ÅŸmalarÄ±n kaÃ§ katÄ± Ã¼cretle Ã§arpÄ±lacaÄŸÄ±.</span></span></label>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px;">
                    <div><small>H.Ä°Ã§i</small><input type="number" id="set_h_ici" step="0.1"></div>
                    <div><small>Pazar</small><input type="number" id="set_pazar" step="0.1"></div>
                    <div><small>Tatil</small><input type="number" id="set_bayram" step="0.1"></div>
                </div>
            </div>
            <button class="aksiyon-btn kaydet-btn" onclick="ayarlariKaydet()">KAYDET VE DÃ–N</button>
        </div>

        <div id="anaForm" oninput="temizleButonKontrol()">
            <h3 style="text-align:center; color:var(--primary);">MaaÅŸ Hesaplama</h3>
            <label>AylÄ±k Net MaaÅŸ (TL)</label>
            <input type="text" id="a" onfocus="inputFocus(this)" onblur="inputBlur(this)" oninput="maasDegisti(this)">

            <div id="yevmiye_alani" style="display:none;">
                <label style="color: var(--danger); margin-top:15px; display:block;">Ã–zel GÃ¼nlÃ¼k Yevmiye (Opsiyonel)</label>
                <input type="text" id="yevmiye_input" placeholder="BoÅŸsa otomatik hesaplanÄ±r" oninput="formatInput(this)">
            </div>

            <label style="margin-top:15px; display:block;">Fiili Ã‡alÄ±ÅŸÄ±lan GÃ¼n <span class="tooltip-container"><span class="tooltip-icon">?</span><span class="tooltip-text">O ay iÃ§erisinde personelin iÅŸe geldiÄŸi toplam gÃ¼n sayÄ±sÄ±.</span></span></label>
            <input type="number" id="b" placeholder="Ã–rn: 22">

            <hr style="margin:20px 0; border:0; border-top:1px solid var(--border);">
            
            <div class="mesai-grup">
                <div><label>H.Ä°Ã§i (GÃ¼n/Saat)</label><div style="display:flex;gap:2px;"><input type="number" id="h_ici_gun" placeholder="Gn"><input type="number" id="h_ici_saat" placeholder="Sa"></div></div>
                <div><label>Pazar (GÃ¼n/Saat)</label><div style="display:flex;gap:2px;"><input type="number" id="pazar_gun" placeholder="Gn"><input type="number" id="pazar_saat" placeholder="Sa"></div></div>
            </div>
            <div class="mesai-grup">
                <div><label>Tatil (GÃ¼n/Saat)</label><div style="display:flex;gap:2px;"><input type="number" id="tatil_gun" placeholder="Gn"><input type="number" id="tatil_saat" placeholder="Sa"></div></div>
                <div><label>Ek/Prim (TL) <span class="tooltip-container"><span class="tooltip-icon">?</span><span class="tooltip-text">MaaÅŸ harici verilecek ekstra prim veya Ã¶deme.</span></span></label><input type="text" id="ex" placeholder="Ã–rn: 5.500,00" oninput="formatInput(this)"></div>
            </div>

            <button class="aksiyon-btn hesapla-btn" onclick="hesapla()">HESAPLA VE TOPLA</button>
            <button id="temizleButon" class="aksiyon-btn" style="display:none; background:var(--card); color:var(--text); border:1px solid var(--border);" onclick="formuTemizle()">TEMÄ°ZLE</button>
            <div id="cikti" class="sonuc-alani"></div>
        </div>
    </div>
</div>

<div id="module-piyasa" class="module-container">
    <div class="market-container">
        <div class="widget-card" style="padding:0;">
            <div id="tradingview-container" class="tradingview-widget-container">
                <div class="tradingview-widget-container__widget"></div>
                </div>
        </div>

        <div class="widget-card">
            <h3 style="color:var(--primary); margin-top:0;">DÃ¶viz Ã‡evirici (Tahmini)</h3>
            <div class="input-row" style="grid-template-columns: 1fr 1fr;">
                <input type="number" id="curr_amount" placeholder="Miktar" oninput="simpleConvert()">
                <select id="curr_type" onchange="simpleConvert()">
                    <option value="usd">Dolar</option>
                    <option value="eur">Euro</option>
                    <option value="gr">Gram AltÄ±n</option>
                </select>
            </div>
            <div id="curr_result" style="font-size:1.5rem; font-weight:bold; color:var(--success);">0.00 TL</div>
        </div>

        <div class="widget-card" style="height: 600px;">
            <h3 style="margin-top:0; color:var(--primary);">ğŸ“ˆ TÃ¼rkiye Ekonomi GÃ¼ndemi & Ä°ÅŸÃ§i Haberleri</h3>
            <div style="display:flex; flex-direction:column; height: 90%;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 style="margin:0; color:var(--primary); display:flex; align-items:center; gap:10px;">
                        ğŸ”´ TRT Haber Son Dakika
                    </h3>
                    <span style="font-size:0.8rem; color:var(--text); opacity:0.7;">CanlÄ± AkÄ±ÅŸ</span>
                </div>
                
                <div id="trt-haber-container" style="flex:1; overflow-y:auto; padding-right:5px;">
                    <div style="text-align:center; padding:20px; color:var(--text);">Haberler yÃ¼kleniyor...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeSettings()">Ã—</span>
        <h2 style="color:var(--primary)">Uygulama AyarlarÄ±</h2>
        
        <div class="ayar-kart">
            <label>Hava Durumu Åehri</label>
            <select id="citySelector" onchange="updateCity()">
                <option value="Istanbul">Ä°stanbul</option>
                <option value="Ankara">Ankara</option>
                <option value="Izmir">Ä°zmir</option>
                <option value="Bursa">Bursa</option>
                <option value="Adana">Adana</option>
                <option value="Gaziantep">Gaziantep</option>
                <option value="Antalya">Antalya</option>
                <option value="Konya">Konya</option>
                <option value="Kayseri">Kayseri</option>
                <option value="Kocaeli">Kocaeli</option>
            </select>
        </div>

        <div class="ayar-kart" style="border:1px solid var(--info);">
            <label style="color:var(--info);">Veri YÃ¶netimi (Yedekle)</label>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn btn-save" onclick="backupData()">ğŸ’¾ Yedek Ä°ndir</button>
                <button class="btn btn-clean" onclick="document.getElementById('restoreFile').click()">ğŸ“‚ Geri YÃ¼kle</button>
            </div>
            <input type="file" id="restoreFile" style="display:none" onchange="restoreData(this)">
            <small style="display:block; margin-top:5px; color:#64748b;">Verilerin kaybolmasÄ±n diye arasÄ±ra yedek al.</small>
        </div>
        
        <div style="margin-top:20px; text-align:center;">
             <button class="btn btn-save" style="margin: 0 auto; width: 100px;" onclick="closeSettings()">Tamam</button>
        </div>
    </div>
</div>

<div id="aboutModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeAbout()">Ã—</span>
        <h2 style="color:var(--primary)">HakkÄ±nda</h2>
        <p>Bu sistem <b>Lanmod.com</b> tarafÄ±ndan <b>(Gemini AI)</b> desteÄŸiyle geliÅŸtirilmiÅŸtir.</p>
        <p>Versiyon: 2.1 (Sidelya SÃ¼rÃ¼mÃ¼)</p>
    </div>
</div>

<div id="manualModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <span class="close-modal" onclick="closeManual()">Ã—</span>
        <h2 style="color:var(--primary)">ğŸ“˜ KullanÄ±m KÄ±lavuzu</h2>
        <div style="text-align: left; max-height: 400px; overflow-y: auto;">
            <h4 style="color:var(--info)">1. Puantaj ModÃ¼lÃ¼</h4>
            <p style="font-size:0.9rem;">Personelinizin iÅŸe geliÅŸ-gidiÅŸ, izin ve rapor durumlarÄ±nÄ± kaydedin. Excel Ã§Ä±ktÄ±sÄ± alabilir, aylara gÃ¶re filtreleme yapabilirsiniz.</p>
            
            <h4 style="color:var(--info)">2. MaaÅŸ Hesaplama</h4>
            <p style="font-size:0.9rem;">Sabit maaÅŸ veya yevmiye usulÃ¼ hesaplama yapabilirsiniz. Fazla mesai (Hafta iÃ§i, Pazar, Bayram) katsayÄ±larÄ±nÄ± ayarlardan dÃ¼zenleyebilirsiniz.</p>
            
            <h4 style="color:var(--info)">3. Piyasa & Haber</h4>
            <p style="font-size:0.9rem;">GÃ¼ncel dÃ¶viz kurlarÄ±, altÄ±n fiyatlarÄ± ve iÅŸ dÃ¼nyasÄ±ndan son dakika haberlerini takip edebilirsiniz.</p>
            
            <h4 style="color:var(--warning)">âš ï¸ Ã–nemli UyarÄ±</h4>
            <p style="font-size:0.9rem;">Verileriniz tarayÄ±cÄ±nÄ±zda (yerel hafÄ±za) saklanÄ±r. TarayÄ±cÄ± geÃ§miÅŸini temizlerseniz veriler gidebilir. LÃ¼tfen dÃ¼zenli olarak <b>Ayarlar > Yedek Ä°ndir</b> seÃ§eneÄŸini kullanÄ±n.</p>
        </div>
    </div>
</div>

<div id="weatherModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeWeatherModal()">Ã—</span>
        <h2 style="color:var(--primary)">ğŸŒ¤ 5 GÃ¼nlÃ¼k Tahmin & Takvim</h2>
        <div id="weather-forecast-container">YÃ¼kleniyor...</div>
        
        <h3 style="color:var(--holiday); margin-top:20px;">ğŸ“… YaklaÅŸan Ã–nemli GÃ¼nler</h3>
        <ul id="holiday-list" style="text-align:left; font-size:0.9rem; padding-left:20px;">
            <li>1 Ocak: YÄ±lbaÅŸÄ±</li>
            <li>23 Nisan: Ulusal Egemenlik BayramÄ±</li>
            <li>1 MayÄ±s: Ä°ÅŸÃ§i BayramÄ±</li>
            <li>19 MayÄ±s: GenÃ§lik ve Spor BayramÄ±</li>
            <li>15 Temmuz: Demokrasi GÃ¼nÃ¼</li>
            <li>30 AÄŸustos: Zafer BayramÄ±</li>
            <li>29 Ekim: Cumhuriyet BayramÄ±</li>
        </ul>
    </div>
</div>

<div id="backupWarningModal" class="modal">
    <div class="modal-content" style="border: 2px solid var(--primary);">
        <h2 style="color:var(--primary)">ğŸ‘‹ Selamlar!</h2>
        <p>Ben Sidelya. KÃ¼Ã§Ã¼k bir hatÄ±rlatma yapmak istedim.</p>
        <p style="text-align:justify;">Bu sistemdeki verilerin sadece senin bilgisayarÄ±nda (tarayÄ±cÄ±da) saklanÄ±yor. TarayÄ±cÄ± geÃ§miÅŸini temizlersen verilerin uÃ§abilir. Emeklerinin kaybolmasÄ±nÄ± istemem.</p>
        <p style="font-weight:bold; color:var(--danger);">LÃ¼tfen ara sÄ±ra "Ayarlar" bÃ¶lÃ¼mÃ¼nden yedeÄŸini almayÄ± unutma.</p>
        
        <div style="margin-top:20px; display:flex; flex-direction:column; gap:10px;">
            <button class="btn btn-save" style="width:100%; justify-content:center;" onclick="closeBackupWarning(false)">Tamam, AnladÄ±m</button>
            <div style="display:flex; align-items:center; justify-content:center; gap:5px; margin-top:5px;">
                 <input type="checkbox" id="dontShowBackup">
                 <label for="dontShowBackup" style="font-size:0.8rem; cursor:pointer;">Bunu bir daha gÃ¶sterme</label>
            </div>
        </div>
    </div>
</div>


<script>
    /* --- GLOBAL HELPERS --- */
    function switchModule(moduleName, btn) {
        document.querySelectorAll('.module-container').forEach(el => el.classList.remove('active-module'));
        document.getElementById('module-' + moduleName).classList.add('active-module');
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
    }

    function toggleTheme() { 
        document.body.classList.toggle('dark-mode'); 
        updateTradingViewTheme(); // Borsa widget temasÄ±nÄ± gÃ¼ncelle
    }
    
    // Modal Functions
    function openAbout() { document.getElementById('aboutModal').style.display = 'block'; }
    function closeAbout() { document.getElementById('aboutModal').style.display = 'none'; }
    
    function openManual() { document.getElementById('manualModal').style.display = 'block'; }
    function closeManual() { document.getElementById('manualModal').style.display = 'none'; }

    function openWeatherModal() { 
        document.getElementById('weatherModal').style.display = 'block'; 
        fetchExtendedWeather();
    }
    function closeWeatherModal() { document.getElementById('weatherModal').style.display = 'none'; }

    function openSettings() { 
        document.getElementById('settingsModal').style.display = 'block'; 
        const savedCity = localStorage.getItem('sidelya_city') || 'Istanbul';
        document.getElementById('citySelector').value = savedCity;
    }
    function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }

    // Backup Warning Logic
    function checkBackupWarning() {
        const acknowledged = localStorage.getItem('sidelya_backup_acknowledged');
        const hasData = JSON.parse(localStorage.getItem('sidelya_pro_db') || '[]').length > 0;
        
        // EÄŸer daha Ã¶nce kapatmadÄ±ysa ve veri varsa (veya ilk giriÅŸse) gÃ¶ster
        if (!acknowledged) {
            document.getElementById('backupWarningModal').style.display = 'block';
        }
    }

    function closeBackupWarning(forever) {
        if (forever || document.getElementById('dontShowBackup').checked) {
            localStorage.setItem('sidelya_backup_acknowledged', 'true');
        }
        document.getElementById('backupWarningModal').style.display = 'none';
    }

    window.onclick = function(event) {
        if (event.target == document.getElementById('aboutModal')) closeAbout();
        if (event.target == document.getElementById('settingsModal')) closeSettings();
        if (event.target == document.getElementById('manualModal')) closeManual();
        if (event.target == document.getElementById('weatherModal')) closeWeatherModal();
        if (event.target == document.getElementById('backupWarningModal') && localStorage.getItem('sidelya_backup_acknowledged')) {
            document.getElementById('backupWarningModal').style.display = 'none';
        }
    }

    /* --- TRADINGVIEW WIDGET UPDATE --- */
    function updateTradingViewTheme() {
        const container = document.getElementById('tradingview-container');
        container.innerHTML = '<div class="tradingview-widget-container__widget"></div>'; // Temizle
        
        const isDark = document.body.classList.contains('dark-mode');
        const theme = isDark ? 'dark' : 'light';
        
        const script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js';
        script.async = true;
        script.innerHTML = JSON.stringify({
            "symbols": [
                { "proName": "FOREXCOM:SPX500", "title": "S&P 500" },
                { "proName": "FX_IDC:EURTRY", "title": "Euro / TL" },
                { "proName": "FX_IDC:USDTRY", "title": "Dolar / TL" },
                { "proName": "BIST:XU100", "title": "BIST 100" },
                { "proName": "OANDA:XAUUSD", "title": "AltÄ±n / Dolar (Ons)" },
                { "description": "Gram AltÄ±n", "proName": "FX_IDC:XAUUSD*FX_IDC:USDTRY/31.1035" }
            ],
            "showSymbolLogo": true,
            "colorTheme": theme,
            "isTransparent": true,
            "displayMode": "adaptive",
            "locale": "tr"
        });
        container.appendChild(script);
    }

    /* --- BACKUP & RESTORE --- */
    function backupData() {
        const data = {
            logs: JSON.parse(localStorage.getItem('sidelya_pro_db') || '[]'),
            salaryHistory: JSON.parse(localStorage.getItem('gecmisVeri') || '[]'),
            settings: {
                asgari: localStorage.getItem('kayitliAsgari'),
                city: localStorage.getItem('sidelya_city')
            },
            timestamp: new Date().toLocaleString()
        };
        const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `Sidelya_Yedek_${new Date().toISOString().slice(0,10)}.json`;
        link.click();
    }

    function restoreData(input) {
        const file = input.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if(confirm(`Bu yedeÄŸi geri yÃ¼klemek istiyor musun? (${data.timestamp})\nMevcut verilerin Ã¼zerine yazÄ±lacak!`)) {
                    if(data.logs) localStorage.setItem('sidelya_pro_db', JSON.stringify(data.logs));
                    if(data.salaryHistory) localStorage.setItem('gecmisVeri', JSON.stringify(data.salaryHistory));
                    if(data.settings?.asgari) localStorage.setItem('kayitliAsgari', data.settings.asgari);
                    if(data.settings?.city) localStorage.setItem('sidelya_city', data.settings.city);
                    alert("Geri yÃ¼kleme baÅŸarÄ±lÄ±! Sayfa yenileniyor...");
                    location.reload();
                }
            } catch(err) {
                alert("HatalÄ± yedek dosyasÄ±!");
            }
        };
        reader.readAsText(file);
    }

    /* --- WEATHER --- */
    const cityCoords = {
        "Istanbul": { lat: 41.0082, lon: 28.9784 },
        "Ankara": { lat: 39.9334, lon: 32.8597 },
        "Izmir": { lat: 38.4192, lon: 27.1287 },
        "Bursa": { lat: 40.1826, lon: 29.0662 },
        "Adana": { lat: 37.0000, lon: 35.3213 },
        "Gaziantep": { lat: 37.0662, lon: 37.3833 },
        "Antalya": { lat: 36.8969, lon: 30.7133 },
        "Konya": { lat: 37.8667, lon: 32.4833 },
        "Kayseri": { lat: 38.7312, lon: 35.4787 },
        "Kocaeli": { lat: 40.8533, lon: 29.8815 }
    };

    function updateCity() {
        const city = document.getElementById('citySelector').value;
        localStorage.setItem('sidelya_city', city);
        document.getElementById('city-label').innerText = " " + city;
        fetchWeather();
    }

    async function fetchWeather() {
        const city = localStorage.getItem('sidelya_city') || 'Istanbul';
        document.getElementById('city-label').innerText = " " + city;
        const coords = cityCoords[city] || cityCoords["Istanbul"];

        try {
            const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current_weather=true`);
            const data = await response.json();
            const temp = data.current_weather.temperature;
            const code = data.current_weather.weathercode;
            
            document.getElementById('weather-info').innerText = `${temp}Â°C`;
            let icon = "â˜€ï¸";
            if(code > 3) icon = "â˜ï¸";
            if(code > 45) icon = "ğŸŒ«ï¸";
            if(code > 50) icon = "ğŸŒ§ï¸";
            if(code > 70) icon = "â„ï¸";
            document.getElementById('weather-icon').innerText = icon;
        } catch (error) {
            console.log("Hava durumu hatasÄ±");
        }
    }

    async function fetchExtendedWeather() {
        const city = localStorage.getItem('sidelya_city') || 'Istanbul';
        const coords = cityCoords[city] || cityCoords["Istanbul"];
        const container = document.getElementById('weather-forecast-container');
        
        try {
            // GÃ¼nlÃ¼k max/min sÄ±caklÄ±klarÄ± al
            const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&daily=temperature_2m_max,temperature_2m_min&timezone=auto`);
            const data = await response.json();
            
            if(!data.daily) {
                container.innerHTML = "Tahmin verisi alÄ±namadÄ±.";
                return;
            }

            let html = `<table class="data-table"><thead><tr><th>Tarih</th><th>En YÃ¼ksek</th><th>En DÃ¼ÅŸÃ¼k</th></tr></thead><tbody>`;
            
            for(let i=0; i<5; i++) {
                const date = new Date(data.daily.time[i]);
                const dateStr = date.toLocaleDateString('tr-TR', {weekday:'short', day:'numeric', month:'short'});
                const max = data.daily.temperature_2m_max[i];
                const min = data.daily.temperature_2m_min[i];
                html += `<tr><td>${dateStr}</td><td>${max}Â°C</td><td>${min}Â°C</td></tr>`;
            }
            html += "</tbody></table>";
            container.innerHTML = html;

        } catch (error) {
            container.innerHTML = "Hava durumu detayÄ± yÃ¼klenemedi.";
        }
    }

    setInterval(fetchWeather, 1800000);
    fetchWeather();
    updateTradingViewTheme(); // Init widget

    /* --- PUANTAJ LOGIC --- */
    let logs = JSON.parse(localStorage.getItem('sidelya_pro_db')) || [];
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('nodeDate').value = today;

    function updateHeader() {
        const d = new Date();
        document.getElementById('live-clock').innerText = d.toLocaleTimeString('tr-TR');
        document.getElementById('live-date').innerText = d.toLocaleDateString('tr-TR', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
    }
    setInterval(updateHeader, 1000);
    updateHeader();

    function saveRecord() {
        const name = document.getElementById('nodeName').value;
        const status = document.getElementById('nodeStatus').value;
        const note = document.getElementById('nodeContent').value;
        const sDate = document.getElementById('nodeDate').value;
        const eDate = document.getElementById('nodeEndDate').value;
        const editIdx = document.getElementById('editIndex').value;

        if(!name || !sDate) return alert("Ad ve tarih girmelisin!");

        const displayDate = eDate ? `${sDate} / ${eDate}` : sDate;
        // Kaydedilen rawDate YYYY-MM-DD formatÄ±nda olduÄŸu iÃ§in sÄ±ralama doÄŸrudur
        const obj = { name, status, note, date: displayDate, rawDate: sDate, endDate: eDate, timestamp: new Date().toLocaleTimeString('tr-TR') };

        if(editIdx === "-1") logs.push(obj);
        else { logs[editIdx] = obj; document.getElementById('editIndex').value = "-1"; }

        localStorage.setItem('sidelya_pro_db', JSON.stringify(logs));
        resetForm();
        render();
    }

    function render() {
        const out = document.getElementById('output');
        const batchArea = document.getElementById('batchArea');
        const search = document.getElementById('searchBar').value.toLowerCase();
        const selectedMonth = document.getElementById('monthFilter').value || 'all';
        
        out.innerHTML = '';
        let s = { total: 0, geldi: 0, gelmedi: 0, raporlu: 0, yillik: 0, tatil: 0 };
        let visibleCount = 0;

        updateMonthFilter();

        logs.slice().reverse().forEach((item, index) => {
            const realIdx = logs.length - 1 - index;
            // YÄ±l ve AyÄ± birlikte alÄ±yoruz (YYYY-MM) bÃ¶ylece yÄ±llar karÄ±ÅŸmaz
            const itemMonth = item.rawDate.substring(0, 7);

            if((item.name.toLowerCase().includes(search) || item.note.toLowerCase().includes(search)) && 
               (selectedMonth === 'all' || itemMonth === selectedMonth)) {
                
                visibleCount++;
                s.total++;
                if(item.status === 'Geldi') s.geldi++;
                if(item.status === 'Gelmedi') s.gelmedi++;
                if(item.status === 'Raporlu') s.raporlu++;
                if(item.status === 'YÄ±llÄ±k') s.yillik++;
                if(item.status === 'Tatil') s.tatil++;

                out.innerHTML += `
                    <div class="note-card">
                        <input type="checkbox" class="log-check" data-idx="${realIdx}" style="width:18px; height:18px;">
                        <div style="flex:1">
                            <span class="status-pill sp-${item.status.toLowerCase()}">${item.status}</span>
                            <div style="font-size: 0.8rem; color: #64748b; margin-bottom: 5px;">${item.date}</div>
                            <h3 style="margin: 0; color: var(--primary);">${item.name}</h3>
                            <p style="margin: 8px 0 0 0; opacity: 0.9; font-size:0.95rem;">${item.note}</p>
                            <div class="actions">
                                <button class="btn-del" style="border-color: var(--primary); color: var(--primary);" onclick="editItem(${realIdx})">DÃ¼zenle</button>
                                <button class="btn-del" onclick="deleteItem(${realIdx})">Sil</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        });

        batchArea.style.display = visibleCount > 1 ? 'flex' : 'none';
        document.getElementById('s-total').innerText = s.total;
        document.getElementById('s-geldi').innerText = s.geldi;
        document.getElementById('s-gelmedi').innerText = s.gelmedi;
        document.getElementById('s-yillik').innerText = s.yillik;
        document.getElementById('s-tatil').innerText = s.tatil;
    }

    function updateMonthFilter() {
        const filter = document.getElementById('monthFilter');
        // Benzersiz YYYY-MM deÄŸerlerini al ve sÄ±rala
        const months = [...new Set(logs.map(l => l.rawDate.substring(0, 7)))].sort().reverse();
        
        if(months.length <= 1 && logs.length === 0) { 
            filter.style.display = 'none'; 
            filter.innerHTML = '<option value="all">TÃ¼m Aylar</option>'; 
            return; 
        }
        
        const current = filter.value || 'all';
        filter.innerHTML = '<option value="all">TÃ¼m Aylar</option>';
        
        months.forEach(m => {
            // YYYY-MM formatÄ±nÄ± daha okunabilir hale getir (Ã–rn: 2026 - Åubat)
            const [year, month] = m.split('-');
            const dateObj = new Date(year, month - 1);
            const monthName = dateObj.toLocaleString('tr-TR', { month: 'long' });
            filter.innerHTML += `<option value="${m}">${year} - ${monthName}</option>`;
        });
        
        filter.value = current;
    }

    function toggleSelectAll() {
        const isChecked = document.getElementById('selectAll').checked;
        document.querySelectorAll('.log-check').forEach(c => c.checked = isChecked);
    }

    function deleteSelected() {
        const selected = Array.from(document.querySelectorAll('.log-check:checked')).map(c => parseInt(c.dataset.idx));
        if(selected.length === 0) return;
        if(confirm(`${selected.length} kaydÄ± siliyorum?`)) {
            logs = logs.filter((_, idx) => !selected.includes(idx));
            localStorage.setItem('sidelya_pro_db', JSON.stringify(logs));
            document.getElementById('selectAll').checked = false;
            render();
        }
    }

    function editItem(idx) {
        const item = logs[idx];
        document.getElementById('nodeName').value = item.name;
        document.getElementById('nodeStatus').value = item.status;
        document.getElementById('nodeContent').value = item.note;
        document.getElementById('nodeDate').value = item.rawDate;
        document.getElementById('nodeEndDate').value = item.endDate || '';
        document.getElementById('editIndex').value = idx;
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function deleteItem(idx) {
        if(confirm('Silinsin mi?')) {
            logs.splice(idx, 1);
            localStorage.setItem('sidelya_pro_db', JSON.stringify(logs));
            render();
        }
    }

    function resetForm() {
        document.getElementById('nodeName').value = '';
        document.getElementById('nodeContent').value = '';
        document.getElementById('nodeEndDate').value = '';
        document.getElementById('editIndex').value = "-1";
        document.getElementById('nodeDate').value = today;
    }

    function exportExcel() {
        let csv = "\uFEFFTarih;Personel;Durum;Not\n";
        logs.forEach(i => csv += `${i.date};${i.name};${i.status};${i.note.replace(/;/g, ",")}\n`);
        const link = document.createElement("a");
        link.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv;charset=utf-8;' }));
        link.download = "Sidelya_Rapor.csv"; link.click();
    }

    /* --- CURRENCY SIMPLE --- */
    function simpleConvert() {
        // Tahmini kurlar
        const rates = { 'usd': 36.5, 'eur': 39.2, 'gr': 2500 }; 
        const amount = parseFloat(document.getElementById('curr_amount').value) || 0;
        const type = document.getElementById('curr_type').value;
        const result = amount * rates[type];
        document.getElementById('curr_result').innerText = result.toLocaleString('tr-TR', { minimumFractionDigits: 2 }) + " TL";
    }

    /* --- MAAÅ HESAPLAMA LOGIC --- */
    // VarsayÄ±lan Asgari Ãœcreti 2025 net tutarÄ±na (18.002,12 TL) gÃ¼ncelledim.
    let ASGARI_UCRET = localStorage.getItem('kayitliAsgari') ? parseFloat(localStorage.getItem('kayitliAsgari')) : 18002.12;
    let KAT_HICI = localStorage.getItem('katHici') ? parseFloat(localStorage.getItem('katHici')) : 1.5;
    let KAT_PAZAR = localStorage.getItem('katPazar') ? parseFloat(localStorage.getItem('katPazar')) : 2.0;
    let KAT_BAYRAM = localStorage.getItem('katBayram') ? parseFloat(localStorage.getItem('katBayram')) : 2.0;
    let HESAP_MODU = localStorage.getItem('hesapModu') ? localStorage.getItem('hesapModu') : 'sabit';
    let GUNLUK_SAAT = localStorage.getItem('gunlukSaat') ? parseFloat(localStorage.getItem('gunlukSaat')) : 7.5;
    let GECMIS_SINIR = localStorage.getItem('gecmisSinir') ? parseInt(localStorage.getItem('gecmisSinir')) : 5;
    let GECMIS_VERI = JSON.parse(localStorage.getItem('gecmisVeri')) || [];

    // TRT Haber RSS Logic (Existing)
    const RSS_URL = "https://www.trthaber.com/sondakika.rss";
    fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(RSS_URL)}`)
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('trt-haber-container');
            let html = "";
            if(data.status === 'ok' && data.items.length > 0) {
                data.items.forEach(item => {
                    const date = new Date(item.pubDate);
                    const timeStr = date.toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'});
                    html += `
                    <div style="padding: 12px; margin-bottom: 10px; background: var(--bg); border-radius: 8px; border-left: 4px solid var(--danger); transition: transform 0.2s;" onmouseover="this.style.transform='translateX(5px)'" onmouseout="this.style.transform='translateX(0)'">
                        <div style="font-size:0.8rem; color:var(--info); margin-bottom:4px; font-weight:bold;">â° ${timeStr}</div>
                        <a href="${item.link}" target="_blank" style="text-decoration: none; color: var(--text); font-weight: 600; font-size: 0.95rem; display:block; margin-bottom: 5px;">${item.title}</a>
                        <div style="font-size:0.85rem; color:var(--text); opacity:0.8; line-height:1.4;">${item.description ? item.description.replace(/<[^>]*>?/gm, '').substring(0, 100) + '...' : ''}</div>
                    </div>`;
                });
                container.innerHTML = html;
            } else { container.innerHTML = '<div style="color:var(--danger)">Haberler alÄ±namadÄ±. BaÄŸlantÄ±nÄ±zÄ± kontrol edin.</div>'; }
        })
        .catch(error => { document.getElementById('trt-haber-container').innerHTML = '<div style="color:var(--danger)">Haber kaynaÄŸÄ±na ulaÅŸÄ±lamadÄ±.</div>'; });

    window.onload = function() { 
        render();
        inputGuncelle();
        arayuzAyarlariniUygula();
        temizleButonKontrol();
        checkBackupWarning(); // Ä°lk aÃ§Ä±lÄ±ÅŸta yedekleme uyarÄ±sÄ±nÄ± kontrol et
    };

    function temizleButonKontrol() {
        const ids = ['b', 'h_ici_gun', 'h_ici_saat', 'pazar_gun', 'pazar_saat', 'tatil_gun', 'tatil_saat', 'ex', 'yevmiye_input'];
        let doluMu = ids.some(id => {
            let el = document.getElementById(id);
            if(!el) return false;
            let val = el.value;
            return val !== "" && val !== "0";
        });
        const btn = document.getElementById('temizleButon');
        if(btn) btn.style.display = doluMu ? "block" : "none";
    }

    function tumunuGizle() {
        ['anaForm', 'yÃ¶netimPaneli', 'hesapMakinesiPaneli', 'gecmisPaneli'].forEach(id => {
            const el = document.getElementById(id);
            if(el) el.style.display = "none";
        });
        const el = document.querySelector('.maas-ust-butonlar');
        if(el) el.style.display = "none";
    }
    function anaFormuAc() {
        tumunuGizle();
        document.getElementById('anaForm').style.display = "block";
        document.querySelector('.maas-ust-butonlar').style.display = "flex";
    }
    function panelToggle() { 
        tumunuGizle(); 
        document.getElementById('yÃ¶netimPaneli').style.display = "block"; 
        document.getElementById('set_asgari').value = paraFormat(ASGARI_UCRET);
        document.getElementById('set_gecmis_sinir').value = GECMIS_SINIR;
        document.getElementById('set_h_ici').value = KAT_HICI;
        document.getElementById('set_pazar').value = KAT_PAZAR;
        document.getElementById('set_bayram').value = KAT_BAYRAM;
        document.getElementById('set_mod').value = HESAP_MODU;
        document.getElementById('set_gunluk_saat').value = GUNLUK_SAAT;
    }
    function calcToggle() { tumunuGizle(); document.getElementById('hesapMakinesiPaneli').style.display = "block"; }
    function gecmisToggle() { tumunuGizle(); document.getElementById('gecmisPaneli').style.display = "block"; gecmisListele(); }

    function gecmisEkle(detay) {
        const simdi = new Date();
        const tarih = simdi.toLocaleDateString('tr-TR') + " " + simdi.toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'});
        GECMIS_VERI.unshift({ id: Date.now(), tarih, ...detay });
        if (GECMIS_VERI.length > GECMIS_SINIR) GECMIS_VERI.pop();
        localStorage.setItem('gecmisVeri', JSON.stringify(GECMIS_VERI));
    }

    function gecmisListele() {
        const liste = document.getElementById('gecmisListe');
        liste.innerHTML = GECMIS_VERI.length === 0 ? "<p style='text-align:center; color:var(--text); opacity:0.6;'>KayÄ±t bulunamadÄ±.</p>" : "";
        GECMIS_VERI.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = `gecmis-kart`;
            div.innerHTML = `
                <div class="tek-sil-btn" onclick="gecmisTekSil(${item.id})">Sil</div>
                <div style="font-size:11px; color:var(--success); font-weight:bold; border-bottom:1px solid var(--border); margin-bottom:5px;">${item.tarih}</div>
                <div class="sonuc-satir" style="border:none;"><span>Yevmiye (${item.baseHours}s):</span> <b>${item.yevmiye}</b></div>
                <div class="sonuc-satir"><span>Ana HakediÅŸ:</span> <b>${item.hakedis}</b></div>
                <div class="sonuc-satir" style="color:var(--success);"><span>Mesai:</span> <b>+${item.mesaiTotal}</b></div>
                <div class="sonuc-satir"><span>Ek:</span> <b>+${item.ek}</b></div>
                <div class="sonuc-satir toplam-vurgu" style="font-size:16px; margin-top:5px;"><span>TOPLAM:</span> <span>${item.toplam}</span></div>
            `;
            liste.appendChild(div);
        });
    }

    function gecmisTekSil(id) {
        GECMIS_VERI = GECMIS_VERI.filter(item => item.id !== id);
        localStorage.setItem('gecmisVeri', JSON.stringify(GECMIS_VERI));
        gecmisListele();
    }

    function gecmisTemizle() { if(confirm("TÃ¼m geÃ§miÅŸ silinecek?")) { GECMIS_VERI = []; localStorage.setItem('gecmisVeri', "[]"); gecmisListele(); } }

    function formuTemizle() {
        const ids = ['b', 'h_ici_gun', 'h_ici_saat', 'pazar_gun', 'pazar_saat', 'tatil_gun', 'tatil_saat', 'ex', 'yevmiye_input'];
        ids.forEach(id => {
            const el = document.getElementById(id);
            if(el) el.value = "";
        });
        document.getElementById('cikti').style.display = "none";
        inputGuncelle();
        temizleButonKontrol();
    }

    function ayarlariKaydet() {
        ASGARI_UCRET = parseLocaleNumber(document.getElementById('set_asgari').value);
        GECMIS_SINIR = parseInt(document.getElementById('set_gecmis_sinir').value);
        KAT_HICI = parseFloat(document.getElementById('set_h_ici').value);
        KAT_PAZAR = parseFloat(document.getElementById('set_pazar').value);
        KAT_BAYRAM = parseFloat(document.getElementById('set_bayram').value);
        HESAP_MODU = document.getElementById('set_mod').value;
        GUNLUK_SAAT = parseFloat(document.getElementById('set_gunluk_saat').value);
        
        localStorage.setItem('kayitliAsgari', ASGARI_UCRET);
        localStorage.setItem('gecmisSinir', GECMIS_SINIR);
        localStorage.setItem('katHici', KAT_HICI);
        localStorage.setItem('katPazar', KAT_PAZAR);
        localStorage.setItem('katBayram', KAT_BAYRAM);
        localStorage.setItem('hesapModu', HESAP_MODU);
        localStorage.setItem('gunlukSaat', GUNLUK_SAAT);
        
        inputGuncelle(); arayuzAyarlariniUygula(); anaFormuAc();
    }

    let calcExpression = "";
    function calcInput(val) { calcExpression += val; document.getElementById('calcDisplay').innerText = calcExpression; }
    function calcClear() { calcExpression = ""; document.getElementById('calcDisplay').innerText = "0"; }
    function calcResult() { try { let res = eval(calcExpression); document.getElementById('calcDisplay').innerText = res.toLocaleString('tr-TR'); calcExpression = res.toString(); } catch { document.getElementById('calcDisplay').innerText = ":]"; calcExpression = ""; } }
    function arayuzAyarlariniUygula() { document.getElementById('yevmiye_alani').style.display = (HESAP_MODU === 'yevmiye') ? "block" : "none"; }
    function inputGuncelle() { document.getElementById('a').value = paraFormat(ASGARI_UCRET); }
    function inputFocus(input) { if (parseLocaleNumber(input.value) === ASGARI_UCRET) input.value = ""; }
    function inputBlur(input) { if (input.value.trim() === "") input.value = paraFormat(ASGARI_UCRET); }
    function paraFormat(s) { return s.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); }
    function parseLocaleNumber(s) { return s ? parseFloat(s.toString().replace(/\./g, '').replace(',', '.')) : 0; }
    function formatInput(input) {
        let v = input.value.replace(/\D/g, "");
        if (v === "") return;
        input.value = (parseInt(v) / 100).toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }
    function maasDegisti(input) { formatInput(input); }

    function hesapla() {
        let maas = parseLocaleNumber(document.getElementById('a').value);
        let ozelYevmiye = document.getElementById('yevmiye_input') ? parseLocaleNumber(document.getElementById('yevmiye_input').value) : 0;
        let gun = Number(document.getElementById('b').value) || 0;
        
        let gunluk = (HESAP_MODU === 'yevmiye' && ozelYevmiye > 0) ? ozelYevmiye : (maas / 30);
        let saatlik = gunluk / GUNLUK_SAAT; 

        let h_ici_gun = Number(document.getElementById('h_ici_gun').value) || 0;
        let h_ici_saat = Number(document.getElementById('h_ici_saat').value) || 0;
        let pazar_gun = Number(document.getElementById('pazar_gun').value) || 0;
        let pazar_saat = Number(document.getElementById('pazar_saat').value) || 0;
        let tatil_gun = Number(document.getElementById('tatil_gun').value) || 0;
        let tatil_saat = Number(document.getElementById('tatil_saat').value) || 0;
        let ek = parseLocaleNumber(document.getElementById('ex').value) || 0;

        let anaHakedis = (HESAP_MODU === 'sabit') ? (gun > 0 ? (gunluk * gun) : maas) : (gunluk * gun);
        let m1 = ((h_ici_gun * gunluk) + (h_ici_saat * saatlik)) * KAT_HICI;
        let m2 = ((pazar_gun * gunluk) + (pazar_saat * saatlik)) * KAT_PAZAR;
        let m3 = ((tatil_gun * gunluk) + (tatil_saat * saatlik)) * KAT_BAYRAM;
        let mesaiTotal = m1 + m2 + m3;
        let toplamGenel = anaHakedis + mesaiTotal + ek;

        gecmisEkle({ 
            hakedis: paraFormat(anaHakedis), 
            mesaiTotal: paraFormat(mesaiTotal), 
            ek: paraFormat(ek), 
            toplam: paraFormat(toplamGenel),
            yevmiye: paraFormat(gunluk),
            saatlik: paraFormat(saatlik),
            calisilanGun: (gun > 0 ? gun : 30),
            baseHours: GUNLUK_SAAT,
            detayM1: paraFormat(m1),
            detayM2: paraFormat(m2),
            detayM3: paraFormat(m3)
        });

        let cikti = document.getElementById('cikti');
        cikti.style.display = "block";
                cikti.innerHTML = `
            <div class="sonuc-baslik">HESAP DÃ–KÃœMÃœ</div>
            <div class="sonuc-satir"><span>GÃ¼nlÃ¼k (${GUNLUK_SAAT}s BazlÄ±):</span> <b>${paraFormat(gunluk)} TL</b></div>
            <div class="sonuc-satir"><span>Saatlik:</span> <b>${paraFormat(saatlik)} TL</b></div>
            <div class="sonuc-satir"><span>HakediÅŸ:</span> <b>${paraFormat(anaHakedis)} TL</b></div>
            ${mesaiTotal > 0 ? `<div class="sonuc-satir" style="color:var(--success);"><span>Mesai:</span> <b>+${paraFormat(mesaiTotal)} TL</b></div>` : ''}
            ${ek > 0 ? `<div class="sonuc-satir"><span>Ek:</span> <b>+${paraFormat(ek)} TL</b></div>` : ''}
            <div class="sonuc-satir toplam-vurgu"><span>TOPLAM:</span> <span>${paraFormat(toplamGenel)} TL</span></div>
        `;
        temizleButonKontrol();
        cikti.scrollIntoView({ behavior: 'smooth' });
    }
</script>
</body>
</html>



